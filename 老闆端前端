<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸª åº—å®¶å¾Œå°ç®¡ç†</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      margin: 0;
      background-color: #f7f7f7;
    }
    header {
      background-color: #43a047;
      color: white;
      text-align: center;
      padding: 15px;
      font-size: 22px;
      font-weight: bold;
    }
    .container {
      max-width: 700px;
      margin: 20px auto;
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    h2 {
      color: #333;
      border-bottom: 2px solid #43a047;
      padding-bottom: 5px;
    }
    button {
      cursor: pointer;
      border: none;
      border-radius: 6px;
      padding: 8px 14px;
      font-size: 15px;
      font-weight: bold;
      transition: 0.2s;
    }
    .open-btn {
      background-color: #4caf50;
      color: white;
    }
    .open-btn:hover {
      background-color: #2e7d32;
    }
    .close-btn {
      background-color: #e53935;
      color: white;
    }
    .close-btn:hover {
      background-color: #c62828;
    }
    .status {
      text-align: center;
      font-size: 18px;
      margin-top: 10px;
      font-weight: bold;
    }
    .status.open {
      color: #43a047;
    }
    .status.closed {
      color: #e53935;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid #ccc;
    }
    th {
      background-color: #e8f5e9;
    }
    input[type="text"], input[type="number"], input[type="time"] {
      padding: 6px;
      width: 90%;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .action-btn {
      background-color: #ff9800;
      color: white;
    }
    .action-btn:hover {
      background-color: #fb8c00;
    }
    .delete-btn {
      background-color: #f44336;
      color: white;
    }
    .delete-btn:hover {
      background-color: #e53935;
    }
    .confirm-btn {
      background-color: #4caf50;
      color: white;
    }
    .confirm-btn:hover {
      background-color: #388e3c;
    }
    .cancel-btn {
      background-color: #f44336;
      color: white;
    }
    .cancel-btn:hover {
      background-color: #d32f2f;
    }
    .row {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-top: 8px;
    }
    .small {
      padding: 6px 8px;
      font-size: 13px;
    }
    footer {
      text-align: center;
      margin-top: 20px;
      color: #777;
    }
  </style>
</head>
<body>
  <header>ğŸª åº—å®¶å¾Œå°ç®¡ç†ç³»çµ±</header>
  <div class="container">
    <!-- è€é—†å§“å -->
    <h2>ğŸ‘¤ è€é—†å§“åè¨­å®š</h2>
    <div class="row">
      <input type="text" id="ownerName" placeholder="è¼¸å…¥è€é—†å§“å" required>
      <button class="confirm-btn small" id="saveOwnerBtn">å„²å­˜</button>
    </div>

    <!-- åº—å®¶æ‹›ç‰Œ -->
    <h2>ğŸª§ åº—å®¶æ‹›ç‰Œè¨­å®š</h2>
    <div class="row">
      <input type="text" id="shopSign" placeholder="è¼¸å…¥åº—å®¶æ‹›ç‰Œåç¨±" required>
      <button class="confirm-btn small" id="saveSignBtn">å„²å­˜</button>
    </div>

    <!-- ç‡Ÿæ¥­ç‹€æ…‹ -->
    <h2>ğŸ•’ ç‡Ÿæ¥­ç‹€æ…‹</h2>
    <div style="text-align:center;">
      <button class="open-btn" id="openBtn">ğŸŸ¢ é–‹å§‹ç‡Ÿæ¥­</button>
      <button class="close-btn" id="closeBtn">ğŸ”´ çµæŸç‡Ÿæ¥­</button>
    </div>
    <div id="statusText" class="status closed">ç›®å‰ç‹€æ…‹ï¼šä¼‘æ¥­ä¸­</div>

    <!-- è¨­å®šç‡Ÿæ¥­èˆ‡ä¼‘æ¥­æ™‚é–“ -->
    <h2>â° è¨­å®šç‡Ÿæ¥­èˆ‡ä¼‘æ¥­æ™‚é–“ï¼ˆè€é—†è¨­å®šï¼‰</h2>
    <form id="hoursForm">
      <table>
        <tr>
          <th>æ˜ŸæœŸ</th>
          <th>ç‡Ÿæ¥­é–‹å§‹æ™‚é–“</th>
          <th>ç‡Ÿæ¥­çµæŸæ™‚é–“</th>
        </tr>
        <tr>
          <td>æ˜ŸæœŸä¸€</td>
          <td><input type="time" name="mondayOpen" required></td>
          <td><input type="time" name="mondayClose" required></td>
        </tr>
        <tr>
          <td>æ˜ŸæœŸäºŒ</td>
          <td><input type="time" name="tuesdayOpen" required></td>
          <td><input type="time" name="tuesdayClose" required></td>
        </tr>
        <tr>
          <td>æ˜ŸæœŸä¸‰</td>
          <td><input type="time" name="wednesdayOpen" required></td>
          <td><input type="time" name="wednesdayClose" required></td>
        </tr>
        <tr>
          <td>æ˜ŸæœŸå››</td>
          <td><input type="time" name="thursdayOpen" required></td>
          <td><input type="time" name="thursdayClose" required></td>
        </tr>
        <tr>
          <td>æ˜ŸæœŸäº”</td>
          <td><input type="time" name="fridayOpen" required></td>
          <td><input type="time" name="fridayClose" required></td>
        </tr>
        <tr>
          <td>æ˜ŸæœŸå…­</td>
          <td><input type="time" name="saturdayOpen" required></td>
          <td><input type="time" name="saturdayClose" required></td>
        </tr>
        <tr>
          <td>æ˜ŸæœŸæ—¥</td>
          <td><input type="time" name="sundayOpen" required></td>
          <td><input type="time" name="sundayClose" required></td>
        </tr>
      </table>
      <div style="text-align:right; margin-top:8px;">
        <button type="submit" class="confirm-btn">å„²å­˜æ™‚é–“è¨­å®š</button>
      </div>
    </form>

    <!-- èœå–®ç®¡ç† -->
    <h2>ğŸ“‹ èœå–®ç®¡ç†</h2>
    <div class="row">
      <input type="text" id="itemName" placeholder="è¼¸å…¥å“é …åç¨±">
      <input type="number" id="itemStock" placeholder="è¼¸å…¥åº«å­˜æ•¸é‡" min="0">
      <button class="action-btn" id="addItemBtn">â• æ–°å¢å“é …</button>
    </div>
    <table id="menuTable">
      <thead>
        <tr>
          <th>å“é …</th>
          <th>åº«å­˜</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- é è³¼è¨‚å–®ç®¡ç† -->
    <h2>ğŸ“¦ é è³¼è¨‚å–®ç®¡ç†</h2>
    <div class="row">
      <input type="text" id="preItemName" placeholder="è¼¸å…¥é è³¼å“é …">
      <input type="number" id="preQuantity" placeholder="æ•¸é‡" min="1">
      <button class="action-btn" id="addPreBtn">â• æ–°å¢é è³¼è¨‚å–®</button>
    </div>
    <table id="preorderTable">
      <thead>
        <tr>
          <th>å“é …</th>
          <th>æ•¸é‡</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- å·²æ¥å—è¨‚å–® -->
    <h2>âœ… å·²æ¥å—è¨‚å–®</h2>
    <table id="acceptedTable">
      <thead>
        <tr>
          <th>å“é …</th>
          <th>æ•¸é‡</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <footer>
    <p>ğŸª åº—å®¶ç®¡ç†ç³»çµ± - ç‰ˆæ¬Šæ‰€æœ‰</p>
  </footer>

  <script>
    // ----- ç°¡å–®è³‡æ–™æ¨¡å‹å­˜åœ¨ localStorage -----
    const STORAGE_KEYS = {
      OWNER: 'store_owner',
      SIGN: 'store_sign',
      STATUS: 'store_status', // 'open' or 'closed'
      HOURS: 'store_hours',
      MENU: 'store_menu', // array of {id, name, stock}
      PREORDERS: 'store_preorders', // array of {id, name, quantity}
      ACCEPTED: 'store_accepted' // array of {id, name, quantity}
    };

    // helper: ç”¢ç”Ÿ ID
    function genId(prefix='id') {
      return prefix + '_' + Date.now() + '_' + Math.floor(Math.random()*1000);
    }

    // å– localStorageï¼ˆè‹¥æ²’æœ‰å‰‡å›å‚³é è¨­ï¼‰
    function load(key, def) {
      try {
        const raw = localStorage.getItem(key);
        return raw ? JSON.parse(raw) : def;
      } catch (e) {
        console.error('load error', e);
        return def;
      }
    }
    function save(key, value) {
      try {
        localStorage.setItem(key, JSON.stringify(value));
      } catch (e) {
        console.error('save error', e);
      }
    }

    // DOM elements
    const ownerNameInput = document.getElementById('ownerName');
    const shopSignInput = document.getElementById('shopSign');
    const statusText = document.getElementById('statusText');
    const openBtn = document.getElementById('openBtn');
    const closeBtn = document.getElementById('closeBtn');

    const hoursForm = document.getElementById('hoursForm');

    const menuTableBody = document.querySelector('#menuTable tbody');
    const preorderTableBody = document.querySelector('#preorderTable tbody');
    const acceptedTableBody = document.querySelector('#acceptedTable tbody');

    const addItemBtn = document.getElementById('addItemBtn');
    const addPreBtn = document.getElementById('addPreBtn');

    const saveOwnerBtn = document.getElementById('saveOwnerBtn');
    const saveSignBtn = document.getElementById('saveSignBtn');

    // åˆå§‹è¼‰å…¥
    function init() {
      // è¼‰å…¥åº—å®¶è³‡è¨Š
      const owner = load(STORAGE_KEYS.OWNER, '');
      const sign = load(STORAGE_KEYS.SIGN, '');
      ownerNameInput.value = owner;
      shopSignInput.value = sign;

      // è¼‰å…¥ç‹€æ…‹
      const status = load(STORAGE_KEYS.STATUS, 'closed');
      applyStatus(status);

      // è¼‰å…¥ç‡Ÿæ¥­æ™‚é–“
      const hours = load(STORAGE_KEYS.HOURS, null);
      if (hours) {
        // æŠŠæ™‚é–“è¨­å®šå›è¡¨å–®
        for (const [key, val] of Object.entries(hours)) {
          const input = hoursForm.elements[key];
          if (input) input.value = val;
        }
      }

      // è¼‰å…¥èœå–®ã€é è³¼ã€å·²æ¥å—
      renderMenu();
      renderPreorders();
      renderAccepted();
    }

    // set status (open/closed)
    function applyStatus(status) {
      if (status === 'open') {
        statusText.textContent = 'ç›®å‰ç‹€æ…‹ï¼šç‡Ÿæ¥­ä¸­';
        statusText.classList.remove('closed');
        statusText.classList.add('open');
      } else {
        statusText.textContent = 'ç›®å‰ç‹€æ…‹ï¼šä¼‘æ¥­ä¸­';
        statusText.classList.remove('open');
        statusText.classList.add('closed');
      }
      save(STORAGE_KEYS.STATUS, status);
    }

    // ç¶å®šæŒ‰éˆ•
    openBtn.addEventListener('click', () => applyStatus('open'));
    closeBtn.addEventListener('click', () => applyStatus('closed'));

    // å„²å­˜ owner / sign
    saveOwnerBtn.addEventListener('click', () => {
      const v = ownerNameInput.value.trim();
      save(STORAGE_KEYS.OWNER, v);
      alert('å·²å„²å­˜è€é—†å§“å');
    });
    saveSignBtn.addEventListener('click', () => {
      const v = shopSignInput.value.trim();
      save(STORAGE_KEYS.SIGN, v);
      alert('å·²å„²å­˜åº—å®¶æ‹›ç‰Œ');
    });

    // å„²å­˜ç‡Ÿæ¥­æ™‚é–“
    hoursForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const formData = new FormData(hoursForm);
      const obj = {};
      for (const [k, v] of formData.entries()) {
        obj[k] = v;
      }
      save(STORAGE_KEYS.HOURS, obj);
      alert('ç‡Ÿæ¥­æ™‚é–“å·²å„²å­˜');
    });

    // ---- èœå–®ç®¡ç† ----
    function getMenu() {
      return load(STORAGE_KEYS.MENU, []);
    }
    function renderMenu() {
      const arr = getMenu();
      menuTableBody.innerHTML = '';
      if (arr.length === 0) {
        const tr = document.createElement('tr');
        tr.innerHTML = '<td colspan="3">ç›®å‰æ²’æœ‰å“é …</td>';
        menuTableBody.appendChild(tr);
        return;
      }
      arr.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${escapeHtml(item.name)}</td>
          <td>${item.stock}</td>
          <td>
            <button class="delete-btn small" data-id="${item.id}">åˆªé™¤</button>
          </td>`;
        menuTableBody.appendChild(tr);
      });
      // ç¶å®šåˆªé™¤
      menuTableBody.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          deleteMenuItem(id);
        });
      });
    }
    function addMenuItem(name, stock) {
      if (!name) return alert('è«‹è¼¸å…¥å“é …åç¨±');
      stock = parseInt(stock) || 0;
      const arr = getMenu();
      const newItem = { id: genId('menu'), name, stock };
      arr.push(newItem);
      save(STORAGE_KEYS.MENU, arr);
      renderMenu();
    }
    function deleteMenuItem(id) {
      let arr = getMenu();
      arr = arr.filter(i => i.id !== id);
      save(STORAGE_KEYS.MENU, arr);
      renderMenu();
    }
    addItemBtn.addEventListener('click', () => {
      const name = document.getElementById('itemName').value.trim();
      const stock = document.getElementById('itemStock').value;
      addMenuItem(name, stock);
      document.getElementById('itemName').value = '';
      document.getElementById('itemStock').value = '';
    });

    // ---- é è³¼è¨‚å–®ç®¡ç† ----
    function getPreorders() {
      return load(STORAGE_KEYS.PREORDERS, []);
    }
    function renderPreorders() {
      const arr = getPreorders();
      preorderTableBody.innerHTML = '';
      if (arr.length === 0) {
        const tr = document.createElement('tr');
        tr.innerHTML = '<td colspan="3">ç›®å‰æ²’æœ‰é è³¼è¨‚å–®</td>';
        preorderTableBody.appendChild(tr);
        return;
      }
      arr.forEach(o => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${escapeHtml(o.name)}</td>
          <td>${o.quantity}</td>
          <td>
            <button class="confirm-btn small" data-id="${o.id}">æ¥å—</button>
            <button class="delete-btn small" data-id="${o.id}">åˆªé™¤</button>
          </td>`;
        preorderTableBody.appendChild(tr);
      });
      // ç¶å®šæŒ‰éˆ•
      preorderTableBody.querySelectorAll('.confirm-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          acceptPreorder(id);
        });
      });
      preorderTableBody.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          deletePreorder(id);
        });
      });
    }
    function addPreorder(name, quantity) {
      if (!name) return alert('è«‹è¼¸å…¥é è³¼å“é …åç¨±');
      quantity = parseInt(quantity);
      if (!quantity || quantity <= 0) return alert('è«‹è¼¸å…¥æœ‰æ•ˆæ•¸é‡');
      const arr = getPreorders();
      arr.push({ id: genId('pre'), name, quantity });
      save(STORAGE_KEYS.PREORDERS, arr);
      renderPreorders();
    }
    function deletePreorder(id) {
      let arr = getPreorders();
      arr = arr.filter(p => p.id !== id);
      save(STORAGE_KEYS.PREORDERS, arr);
      renderPreorders();
    }
    function acceptPreorder(id) {
      // å°‡é è³¼è½‰ç‚ºå·²æ¥å—ï¼ˆç§»å‹•ï¼‰
      const arr = getPreorders();
      const idx = arr.findIndex(p => p.id === id);
      if (idx === -1) return;
      const accepted = load(STORAGE_KEYS.ACCEPTED, []);
      accepted.push({ id: genId('acc'), name: arr[idx].name, quantity: arr[idx].quantity });
      save(STORAGE_KEYS.ACCEPTED, accepted);
      // åˆªé™¤é è³¼
      arr.splice(idx, 1);
      save(STORAGE_KEYS.PREORDERS, arr);
      renderPreorders();
      renderAccepted();
    }
    addPreBtn.addEventListener('click', () => {
      const name = document.getElementById('preItemName').value.trim();
      const qty = document.getElementById('preQuantity').value;
      addPreorder(name, qty);
      document.getElementById('preItemName').value = '';
      document.getElementById('preQuantity').value = '';
    });

    // ---- å·²æ¥å— ----
    function getAccepted() {
      return load(STORAGE_KEYS.ACCEPTED, []);
    }
    function renderAccepted() {
      const arr = getAccepted();
      acceptedTableBody.innerHTML = '';
      if (arr.length === 0) {
        const tr = document.createElement('tr');
        tr.innerHTML = '<td colspan="2">ç›®å‰æ²’æœ‰å·²æ¥å—è¨‚å–®</td>';
        acceptedTableBody.appendChild(tr);
        return;
      }
      arr.forEach(a => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${escapeHtml(a.name)}</td><td>${a.quantity}</td>`;
        acceptedTableBody.appendChild(tr);
      });
    }

    // å°å·¥å…·ï¼šé¿å… XSS
    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    // åˆå§‹åŒ–
    init();
  </script>
</body>
</html>
